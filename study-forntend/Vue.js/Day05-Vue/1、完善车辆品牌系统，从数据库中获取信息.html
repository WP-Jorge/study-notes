<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title></title>
		<script src="./lib/vue.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<style>
			
		</style>
		
	</head>
	
	<body>
		<div id="div01">
			<!-- 使用v-model与nv中的数据双向绑定 -->
			<!-- ID：<input type="text" v-model="id"/> -->
			Name：<input type="text" v-model="name" @keyup.enter="add"/>
			<input type="button" value="添加" @click="add"/>
			Search：<input type="text" v-model="keywords"/>
			<!-- 定义一个列表 -->
			<table border="2px" cellspacing="5px" cellpadding="5px">
				<!-- 表题 -->
				<thead>
					<tr>
						<th>ID</th>
						<th>Name</th>
						<th>Ctime</th>
						<th>Operation</th>
					</tr>
				</thead>
				<!-- 表体 -->
				<tbody>
					<!-- 使用v-for循环遍历list表，并使用v-bind绑定nv中的数据 -->
					<tr v-for="item in search(keywords)" :key="item.id">
						<td>{{ item.id }}</td>
						<td>{{ item.name }}</td>
						<td>{{ item.ctime | dateformate()}}</td>
						<td>
							<a @click.prevent="del(item.id)" href="">删除</a>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

		
		<script>
			//记得在data后添加.toString()函数
			//全局过滤器'dateformate'对应{{ data | deteformate()}}中的过滤器名deteformate()，data对应{{ data | deteformate()}}中的data
			// Vue.filter('dateformate',function(data){
				//这样只能替换第一个出现的字符串
				// data.replace('被替换的字符串','替换后的字符串')
				//这样使用正则表达式 /被替换的字符串/g  来代替上方'被替换的字符串'，可以实现全部替换，其中g表示全部
				// data.replace(/被替换的字符串/g,'替换后的字符串')
				// return data
				
			// })
			
			//也可在过滤器中传入替换后的字符串
			//Vue.filter('dateformate',function(data,arg){
				//这样只能替换第一个出现的字符串
				// data.replace('被替换的字符串',arg)
				//这样使用正则表达式 /被替换的字符串/g  来代替上方'被替换的字符串'，可以实现全部替换，其中g表示全部
				//data.toString().replace(/2/g,arg)
				//return data
			//})
			
			//多个过滤器一起使用，在{{ data | 过滤器1 |过滤器2 }}
			
			//http://www.liulongbin.top:3005/api/getlunbo
			//http://www.liulongbin.top:3005/api/post
			//http://www.liulongbin.top:3005/api/jsonp
			//新的接口http://api.cms.liulongbin.top
			//获取列表地址:  http://www.liulongbin.top:3005/api/getprodlist/
			//添加地址:  http://www.liulongbin.top:3005/api/addproduct/
			//删除地址:  http://www.liulongbin.top:3005/api/delproduct/
			
			//默认根地址，在axios中可不用像vue-resouce那样，在使用时要去掉url前的/，axios可以随意使用，想用完整的url或想用不完整的都可以
			axios.defaults.baseURL='http://www.liulongbin.top:3005'
			//设置默认表单形式上传
			// axios.defaults.headers.post['Content-Type']='application/x-www-form-urlencoded'
			
			var nv = new Vue({
				el:'#div01',
				data:{
					list:[],
					// id:'',
					name:'',
					keywords:''
				},
				methods:{
					//添加一个list对象方法
					add(){
						axios.post('/api/addproduct/',{name:this.name}).then(result=>{
							var result=result.data
							if(result.status===0){
								this.getAllList()
								console.log('成功')
							}else{
								this.getAllList()
							}
						})
					},
					//删除对应id的对象
					del(id){
						axios.get('/api/delproduct/'+id).then(result=>{
							if(result.data.stutas===200){
								this.getAllList()
							}else{
								this.getAllList()
							}
						})
					},
					//搜索车辆信息，搜索栏默认keywords为''（空），则搜索全部车辆
					search(keywords){
						//第一种
						// var newlist=[]
						// this.list.forEach(item=>{
						// 	if(item.name.indexOf(keywords)!=-1){
						// 		newlist.push(item)
						// 	}
						// })
						// return newlist;
						
						//第二种 使用filter（）方法（过滤器）返回类型数组
						return this.list.filter(item=>{
							if(item.name.includes(keywords)){
								return item
							}
						})
					},
					//获取数据库列表
					getAllList(){
						axios.get('/api/getprodlist/').then(result=>{
							var result=result.data
							// console.log(result)
							if(result.status===0){
								//成功
								this.list=result.message
							}else{
								//失败
								alert('失败')
							}
						})
					}
				},
				//局部过滤器，优先调用全局过滤器，再调用局部过滤器，所以优先调用的全局过滤器会被局部过滤器覆盖
				filters:{
					dateformate(data,formate=""){//给formate取空，以防v区中formate未传入参数导致报错
					//年月日不足位数补足0，如2020-1-1补足后—>2020-01-01
					//padStart(字符串长度,'需要补齐的内容') 在前边补
					//padEnd(字符串长度,'需要补齐的内容') 在后边补
						var dt = new Date(data)
						var y = dt.getFullYear()
						var m = (dt.getMonth()+1).toString().padStart(2,'0')
						var d = (dt.getDate()).toString().padStart(2,'0')
						if(formate.toLowerCase()==="yyyy-mm-dd"){
							return `${y}-${m}-${d}`
						}else{
							var hh = (dt.getHours()).toString().padStart(2,'0')
							var mm = (dt.getMinutes()).toString().padStart(2,'0')
							var ss = (dt.getSeconds()).toString().padStart(2,'0')
							return `${y}-${m}-${d} ${hh}:${mm}:${ss}`
						}
					}
				},
				created(){
					this.getAllList()
				}
			})
			
		</script>
	</body>
	
</html>
