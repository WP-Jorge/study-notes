<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>图片上传</title>
		<script src="/js/jquery.js">
			
		</script>
	</head>
	<body>
		<h1>图片上传</h1>
		<form action="/imgUpload" method="post" enctype="multipart/form-data">
			<label for="fileInput">选择文件</label>
			<input hidden id="fileInput" class="fileInput" type="file" name="imgfile">
			<div class="btn">上传</div>
		</form>
		<div>
			<h3>预览图片</h3>
			<img class="yulan" src="">
		</div>
		<script>
			let formDataObj
			let file
			$('.fileInput').change(function(e) {
				console.log(this.files)
				file = this.files[0]
				// 预览图片
				// 创建预览图片地址
				let httpUrl = window.webkitURL.createObjectURL(file)
				// 生成图片
				$('.yulan').attr('src', httpUrl)
				formDataObj = new FormData()
				// 创建formdata对象，将文件追加到formdata对象中、
				formDataObj.append('imgfile', file)
			})
			$('.btn').click(e => {
				$.ajax({
					url: '/imgUpload',
					method: 'post',
					data: formDataObj,
					// 不需要额外处理
					processData: false,
					// 不需要设置类型，因为上面已经设置过了
					contentType: false
				}).then(res => {
					// console.log(res)
					$('body').append(`<h1>上传成功</h1><img src="${res.imgUrl}"/>`)
				})
			})
		</script>
	</body>
</html>
